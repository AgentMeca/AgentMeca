{"chunk_id": "meca_samples:meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs:da8982440e79", "repo": "meca_samples", "commit": "806f144", "lang": "csharp", "symbol": "unknown", "qualified_name": "unknown", "source_path": "meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs", "loc": [1, 1], "text": "using System;", "hash": "da8982440e79", "chunk_type": "other", "node_type": "using_directive", "signature": null, "docstring": null, "chunk_size_bytes": 13, "original_size_bytes": 13, "start_byte": 0, "end_byte": 13}
{"chunk_id": "meca_samples:meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs:85c1a74a1362", "repo": "meca_samples", "commit": "806f144", "lang": "csharp", "symbol": "unknown", "qualified_name": "unknown", "source_path": "meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs", "loc": [2, 2], "text": "using System.Collections.Generic;", "hash": "85c1a74a1362", "chunk_type": "other", "node_type": "using_directive", "signature": null, "docstring": null, "chunk_size_bytes": 33, "original_size_bytes": 33, "start_byte": 14, "end_byte": 47}
{"chunk_id": "meca_samples:meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs:84d49dbe58aa", "repo": "meca_samples", "commit": "806f144", "lang": "csharp", "symbol": "unknown", "qualified_name": "unknown", "source_path": "meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs", "loc": [3, 3], "text": "using System.Linq;", "hash": "84d49dbe58aa", "chunk_type": "other", "node_type": "using_directive", "signature": null, "docstring": null, "chunk_size_bytes": 18, "original_size_bytes": 18, "start_byte": 48, "end_byte": 66}
{"chunk_id": "meca_samples:meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs:04521bb05ea3", "repo": "meca_samples", "commit": "806f144", "lang": "csharp", "symbol": "unknown", "qualified_name": "unknown", "source_path": "meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs", "loc": [4, 4], "text": "using System.Text;", "hash": "04521bb05ea3", "chunk_type": "other", "node_type": "using_directive", "signature": null, "docstring": null, "chunk_size_bytes": 18, "original_size_bytes": 18, "start_byte": 67, "end_byte": 85}
{"chunk_id": "meca_samples:meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs:727d17e79e1b", "repo": "meca_samples", "commit": "806f144", "lang": "csharp", "symbol": "unknown", "qualified_name": "unknown", "source_path": "meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs", "loc": [5, 5], "text": "using System.Threading.Tasks;", "hash": "727d17e79e1b", "chunk_type": "other", "node_type": "using_directive", "signature": null, "docstring": null, "chunk_size_bytes": 29, "original_size_bytes": 29, "start_byte": 86, "end_byte": 115}
{"chunk_id": "meca_samples:meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs:8f6b99b371d0", "repo": "meca_samples", "commit": "806f144", "lang": "csharp", "symbol": "unknown", "qualified_name": "unknown", "source_path": "meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs", "loc": [6, 6], "text": "using System.Net;", "hash": "8f6b99b371d0", "chunk_type": "other", "node_type": "using_directive", "signature": null, "docstring": null, "chunk_size_bytes": 17, "original_size_bytes": 17, "start_byte": 116, "end_byte": 133}
{"chunk_id": "meca_samples:meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs:6dbacf02f2da", "repo": "meca_samples", "commit": "806f144", "lang": "csharp", "symbol": "unknown", "qualified_name": "unknown", "source_path": "meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs", "loc": [7, 7], "text": "using System.Net.Sockets;", "hash": "6dbacf02f2da", "chunk_type": "other", "node_type": "using_directive", "signature": null, "docstring": null, "chunk_size_bytes": 25, "original_size_bytes": 25, "start_byte": 134, "end_byte": 159}
{"chunk_id": "meca_samples:meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs:49b615535dd4", "repo": "meca_samples", "commit": "806f144", "lang": "csharp", "symbol": "unknown", "qualified_name": "unknown", "source_path": "meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs", "loc": [8, 8], "text": "using System.IO;", "hash": "49b615535dd4", "chunk_type": "other", "node_type": "using_directive", "signature": null, "docstring": null, "chunk_size_bytes": 16, "original_size_bytes": 16, "start_byte": 160, "end_byte": 176}
{"chunk_id": "meca_samples:meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs:6c0653d7d1e4", "repo": "meca_samples", "commit": "806f144", "lang": "csharp", "symbol": "Mecademic_Plugin", "qualified_name": "Mecademic_Plugin", "source_path": "meca500-accessories/flexibowl/csharp/FlexiBowl_Plugin.cs", "loc": [10, 326], "text": "namespace Mecademic_Plugin\n{\n    class Flexibowl_Plugin\n    {\n        UdpClient m_udpClient = new UdpClient(7777);\n        TcpClient m_tcpClient;\n        NetworkStream m_tcpStream;\n        bool m_useTcp = false;\n        private static readonly Dictionary<string, string> CommandMap = new Dictionary<string, string>\n        {\n            {\"MOVE\", \"QX2\"},\n            {\"MOVE FLIP\", \"QX3\"},\n            {\"MOVE BLOW FLIP\", \"QX4\"},\n            {\"MOVE BLOW\", \"QX5\"},\n            {\"SHAKE\", \"QX6\"},\n            {\"LIGHT ON\", \"QX7\"},\n            {\"LIGHT OFF\", \"QX8\"},\n            {\"FLIP\", \"QX10\"},\n            {\"BLOW\", \"QX9\"},\n            {\"QUICK EMPTY OPTION\", \"QX11\"}\n        };\n        public Flexibowl_Plugin() : this(false) { }\n        public Flexibowl_Plugin(bool useTcp)\n        {\n            m_useTcp = useTcp;\n            if (useTcp)\n            {\n                m_tcpClient = new TcpClient();\n                m_tcpClient.ReceiveTimeout = 2000;\n                m_tcpClient.SendTimeout = 2000;\n            }\n        }\n        public bool CheckAlarmStatus(string ipAddress)\n        {\n            try\n            {\n                string response = SendTcpCommand(ipAddress, \"AL\");\n                if (string.IsNullOrEmpty(response) || response.Length < 8)\n                    return false;\n                string hexData = response.Substring(5).Trim('\\r', '\\n', '\\0');\n                if (int.TryParse(hexData, System.Globalization.NumberStyles.HexNumber, null, out int hexValue))\n                {\n                    string binary = Convert.ToString(hexValue, 2).PadLeft(16, '0');\n                    int errorDecimal = Convert.ToInt32(binary, 2);\n                    return errorDecimal == 0; // False if error (>0), True if no error (0)\n                }\n                return false;\n            }\n            catch\n            {\n                return false;\n            }\n        }\n        public string FlexibowlFriendly(string ipAddress, string friendlyCommand)\n        {\n            string sclCommand = CommandMap.ContainsKey(friendlyCommand.ToUpper()) \n                ? CommandMap[friendlyCommand.ToUpper()] \n                : \"QX60\"; // Invalid command\n            return m_useTcp ? SendTcpCommand(ipAddress, sclCommand) : Flexibowl(ipAddress, sclCommand);\n        }\n        public string Flexibowl(string ipAddress, string command)\n        {\n            string m_IpAddress = ipAddress;\n            string m_command = command;\n            string receiveString = \"\";\n            string ReturnFlexibowl = \"\";\n            int byteSent = 0;\n            IPEndPoint ep = new IPEndPoint(0, 0);\n            try\n            {\n                ep = new IPEndPoint(IPAddress.Parse(m_IpAddress), 7775);\n                m_udpClient.Connect(ep);\n                m_udpClient.Client.SendTimeout = 500;\n                m_udpClient.Client.ReceiveTimeout = 500;\n            }\n            catch (Exception ex)\n            {\n                ReturnFlexibowl = ex.ToString();\n                return ReturnFlexibowl;\n            }\n            string dataToSend = m_command.ToUpper();\n            try\n            {\n                Byte[] SCLstring = Encoding.ASCII.GetBytes(dataToSend);\n                Byte[] sendBytes = new Byte[SCLstring.Length + 3];\n                sendBytes[0] = 0;  // Header byte 1\n                sendBytes[1] = 7;  // Header byte 2\n                System.Array.Copy(SCLstring, 0, sendBytes, 2, SCLstring.Length);\n                sendBytes[sendBytes.Length - 1] = 13; // CR terminator\n                byteSent = m_udpClient.Send(sendBytes, sendBytes.Length);\n                var receivedData = m_udpClient.Receive(ref ep);\n                receiveString = Encoding.ASCII.GetString(receivedData);\n                if ((receiveString.Contains(\"%\")) && (dataToSend.Contains(\"Q\")))\n                {\n                    bool moving = true;\n                    while (moving == true)\n                    {\n                        string statusCommand;\n                        if (dataToSend == \"QX11\" || dataToSend == \"QX10\" || dataToSend == \"QX4\" || dataToSend == \"QX3\")\n                        {\n                            statusCommand = \"IO\";\n                        }\n                        else\n                        {\n                            statusCommand = \"SC\";\n                        }\n                        SCLstring = Encoding.ASCII.GetBytes(statusCommand);\n                        sendBytes = new Byte[SCLstring.Length + 3];\n                        sendBytes[0] = 0;\n                        sendBytes[1] = 7;\n                        System.Array.Copy(SCLstring, 0, sendBytes, 2, SCLstring.Length);\n                        sendBytes[sendBytes.Length - 1] = 13; // CR\n                        byteSent = m_udpClient.Send(sendBytes, sendBytes.Length);\n                        receivedData = m_udpClient.Receive(ref ep);\n                        receiveString = Encoding.ASCII.GetString(receivedData);\n                        if (statusCommand == \"IO\")\n                        {\n                            if (receivedData.Length > 13)\n                            {\n                                string movingStatus = Encoding.ASCII.GetString(receivedData, 12, receivedData.Length - 13);\n                                if (int.TryParse(movingStatus, out int status) && status == 1)\n                                {\n                                    moving = false;\n                                }\n                            }\n                        }\n                        else\n                        {\n                            if (receivedData.Length > 9)\n                            {\n                                string movingStatus = Encoding.ASCII.GetString(receivedData, 7, receivedData.Length - 9);\n                                if (int.TryParse(movingStatus, out int status) && status == 0)\n                                {\n                                    moving = false;\n                                }\n                            }\n                        }\n                        System.Threading.Thread.Sleep(100);\n                    }\n                    System.Threading.Thread.Sleep(100);\n                    ReturnFlexibowl = \"Done\";\n                    return ReturnFlexibowl;\n                }\n                else\n                {\n                    SCLstring = new Byte[receivedData.Length - 3];\n                    System.Array.Copy(receivedData, 2, SCLstring, 0, SCLstring.Length);\n                    receiveString = Encoding.ASCII.GetString(SCLstring);\n                    ReturnFlexibowl = receiveString;\n                }\n                return ReturnFlexibowl;\n            }\n            catch (Exception ex)\n            {\n                ReturnFlexibowl = ex.ToString();\n                return ReturnFlexibowl;\n            }\n        }\n        private string SendTcpCommand(string ipAddress, string command)\n        {\n            try\n            {\n                if (!m_tcpClient.Connected)\n                {\n                    m_tcpClient.Connect(ipAddress, 7776);\n                    m_tcpStream = m_tcpClient.GetStream();\n                }\n                byte[] commandBytes = Encoding.ASCII.GetBytes(command.ToUpper());\n                byte[] message = new byte[commandBytes.Length + 3];\n                message[0] = 0;  // Header byte 1\n                message[1] = 7;  // Header byte 2\n                Array.Copy(commandBytes, 0, message, 2, commandBytes.Length);\n                message[message.Length - 1] = 13; // CR terminator\n                m_tcpStream.Write(message, 0, message.Length);\n                byte[] buffer = new byte[1024];\n                int bytesRead = m_tcpStream.Read(buffer, 0, buffer.Length);\n                if (bytesRead > 0)\n                {\n                    return Encoding.ASCII.GetString(buffer, 0, bytesRead);\n                }\n                return \"\";\n            }\n            catch (Exception ex)\n            {\n                return ex.ToString();\n            }\n        }\n        public void Flexibowl_Close()\n        {\n            if (m_useTcp)\n            {\n                m_tcpStream?.Close();\n                m_tcpClient?.Close();\n            }\n            else\n            {\n                m_udpClient?.Dispose();\n            }\n        }\n    }\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            Console.WriteLine(\"///////////FLEXIBOWL PLUGIN EXAMPLE MECADEMIC/////////////\");\n            string returnFlbString = \"\";\n            Flexibowl_Plugin Fb = new Flexibowl_Plugin(true);\n            bool alarmStatus = Fb.CheckAlarmStatus(\"192.168.0.161\");\n            Console.WriteLine($\"Alarm Status: {(alarmStatus ? \"OK\" : \"ALARM\")}\");\n            returnFlbString = Fb.FlexibowlFriendly(\"192.168.0.161\", \"MOVE\");\n            Console.WriteLine($\"Move Result: {returnFlbString}\");\n            returnFlbString = Fb.FlexibowlFriendly(\"192.168.0.161\", \"MOVE FLIP\");\n            Console.WriteLine($\"Move-Flip Result: {returnFlbString}\");\n            returnFlbString = Fb.FlexibowlFriendly(\"192.168.0.161\", \"LIGHT ON\");\n            Console.WriteLine($\"Light On Result: {returnFlbString}\");\n            System.Threading.Thread.Sleep(1000);\n            returnFlbString = Fb.FlexibowlFriendly(\"192.168.0.161\", \"LIGHT OFF\");\n            Console.WriteLine($\"Light Off Result: {returnFlbString}\");\n            Fb.Flexibowl_Close();\n            Console.ReadLine();\n        }\n    }\n}", "hash": "6c0653d7d1e4", "chunk_type": "other", "node_type": "namespace_declaration", "signature": null, "docstring": null, "chunk_size_bytes": 9435, "original_size_bytes": 12860, "start_byte": 178, "end_byte": 13038}
